<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org" lang="ru">
<head>
    <meta charset="UTF-8">
    <title> Научно-практические конференции </title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet"
          integrity="sha384-QWTKZyjpPEjISv5WaRU9OFeRpok6YctnYmDr5pNlyT2bRjXh0JMhjY6hW+ALEwIH" crossorigin="anonymous">
</head>
<body>
<blockquote class="blockquote text-center"><h1>Информационная система научно-практических конференций</h1></blockquote>

<div class="row">
    <div class="col-md-8 offset-md-4">
        <h4>Поиск конференции по любому параметру</h4>
        <form th:action="@{/}">
            <input type="text" name="keyword" id="keyword" size="70" th:value="${keyword}" required/>
            <input type="submit" class="btn btn-success btn-sm" value="Поиск"/>
            <input type="button" class="btn btn-warning btn-sm" value="Очистить" id="btn-Clear"
                   onclick="clearSearch()"/>
        </form>
    </div>
</div>
<table id="1" class="table table-striped table-hover">
    <thead>
    <tr>
        <th scope="col">ID</th>
        <th scope="col">Название</th>
        <th scope="col">Дата проведения<a th:href="@{'/sort'}">
            <button type="button" class="btn btn-outline-secondary">⇅</button>
        </a></th>
        <th scope="col">Модератор</th>
        <th scope="col">Спикер</th>
        <th scope="col">Действия</th>
    </tr>
    </thead>
    <tbody>
    <tr th:each="conf: ${confList}">
        <th scope="row" class="text-black-50" th:text="${conf.ID}">ID отсутствует</th>
        <th scope="row" class="text-black-50" th:text="${conf.conferenceName}">Название отсутствует</th>
        <th scope="row" class="text-black-50" th:text="${conf.meetingDate}">Время проведения отсутствует</th>
        <th scope="row" class="text-black-50" th:text="${conf.moderator}">Модератор отсутствует</th>
        <th scope="row" class="text-black-50" th:text="${conf.speaker}">Спикер отсутствует</th>
        <td>
            <a th:href="@{'/edit/'+${conf.ID}}">
                <button type="button" class="btn btn-info">Редактировать</button>
            </a>
            <a th:href="@{'/delete/'+${conf.ID}}">
                <button type="button" class="btn btn-danger">Удалить</button>
            </a>
        </td>
    </tr>
    </tbody>
</table>
<p class="text-black-50">
    <script type="text/javascript">
        function getRowsColumn() {
            let table = document.getElementById('1')
            let tBody = table.querySelector('tbody')
            const count = tBody.querySelectorAll('tr').length;
            document.write('Количество конференций в таблице: ' + count)
        }

        getRowsColumn()
    </script>
</p>
<p id="averageCounter" class="text-black-50"></p>
<script type="text/javascript">
    function getAverage() {
        let table = document.getElementById('1');
        let tBody = table.querySelector('tbody');
        let rows = tBody.querySelectorAll('tr');
        let totalConferences = rows.length;
        let totalDays = new Set();

        rows.forEach(row => {
            let date = row.querySelector('th:nth-child(3)').textContent;
            totalDays.add(date);
        });
        let average = totalConferences / totalDays.size;
        document.getElementById('averageCounter').textContent = 'Среднее количество конференций в день: ' + average.toFixed(2);
    }

    getAverage();
</script>
<blockquote class="blockquote text-center">
    <a href="/new">
        <button type="button" class="btn btn-primary" data-togge="button" aria-pressed="false"
                th:autocomplete="off">Добавить конференцию
        </button>
    </a>
</blockquote>
<div id="chart_div" class="d-flex justify-content-center"></div>
<script type="text/javascript">
    function clearSearch() {
        window.location = "[[@{/}]]"
    }
</script>
<script type="text/javascript" src="https://www.gstatic.com/charts/loader.js"></script>
<script type="text/javascript" th:inline="javascript">

    google.charts.load('current', {'packages': ['corechart', 'line']});
    google.charts.setOnLoadCallback(drawChart);


    function drawChart() {

        var data = new google.visualization.DataTable();
        data.addColumn('string', 'Дата');
        data.addColumn('number', 'Количество конференций');
        data.addRows([
            /*[# th:each="row : ${chartData}"]*/
            [[${row}]],
            /*[/]*/]);

        var options = {
            'title': 'Количество конференций по дням',
            'width': 800,
            'height': 600,
            orientation: 'horizontal',
            vAxis: {format: '0'}
        };

        var chart = new google.visualization.BarChart(document.getElementById('chart_div'));
        chart.draw(data, options);
        getAverage(); // Вызов функции для подсчета среднего количества конференций в день
    }
</script>
</body>
</html>